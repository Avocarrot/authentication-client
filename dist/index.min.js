!function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r||e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({1:[function(e,t,r){(function(r){"use strict";var n=e("../config/default"),i=e("./services/store"),o=e("./models/user"),s=e("./models/client"),a=e("./models/session"),u=e("./models/authenticator"),c=e("./services/adblocker-detector"),l=e("./services/redirector"),f=e("./services/consumer"),d=e("./api"),p=e("./databases/sandbox"),h=e("../fixtures/users.json"),v=e("../fixtures/tokens.json"),m=e("../fixtures/passwords.json"),y=e("cross-storage").CrossStorageHub;e("es6-promise").polyfill(),e("whatwg-fetch");var _=function(){function e(e){var t=void 0===arguments[1]?n.api.host:arguments[1];if(e===r.Production)return new d.Production(t);if(e===r.Sandbox)return new d.Sandbox(new p(h,v,m));throw new Error("Invalid `environment` passed")}function t(t,d){var p=void 0===arguments[2]?r.Production:arguments[2],h=void 0===arguments[3]?n.login.host:arguments[3],v=void 0===arguments[4]?n.api.host:arguments[4],m=void 0===arguments[5]?n.store.domain:arguments[5],y=new i(m,h+"/hub"),_=e(p,v),g=new s(t,d),b=new f(g,_),w=new o(y,b);return{user:w,session:new a(w,h),authenticator:new u(b),redirector:new l(y,w),adblockerDetector:new c}}var r=Object.freeze({Production:Symbol("Production"),Sandbox:Symbol("Sandbox")}),_=new Map;return{Environment:r,initStorage:function(e){return y.init(e)},getInstanceFor:function(e){var r=e.clientId,n=e.clientSecret,i=e.environment,o=e.loginHost,s=e.apiHost,a=r+"-"+n;if(_.has(a))return _.get(a);var u=t(r,n,i,o,s);return _.set(a,u),u},reset:function(){_.clear()}}}();r.window&&(r.window.AuthenticationClient=_),t.exports=_}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../config/default":2,"../fixtures/passwords.json":3,"../fixtures/tokens.json":4,"../fixtures/users.json":5,"./api":23,"./databases/sandbox":26,"./models/authenticator":27,"./models/client":28,"./models/session":29,"./models/user":30,"./services/adblocker-detector":31,"./services/consumer":32,"./services/redirector":34,"./services/store":35,"cross-storage":11,"es6-promise":12,"whatwg-fetch":22}],2:[function(e,t,r){"use strict";t.exports={api:{host:"//auth.avocarrot.com"},login:{host:"//login.avocarrot.com"},store:{domain:"avocarrot"}}},{}],3:[function(e,t,r){t.exports=[{user_id:"44d2c8e0-762b-4fa5-8571-097c81c3130d",token:"yJhbGcieOiJIUzI1NiIsIJ9nR5cCI6IkpXVC"}]},{}],4:[function(e,t,r){t.exports=[{user_id:"44d2c8e0-762b-4fa5-8571-097c81c3130d",refresh_token:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",access_token:"rkdkJHVBdCjLIIjsIK4NalauxPP8uo5hY8tTN7"}]},{}],5:[function(e,t,r){t.exports=[{id:"44d2c8e0-762b-4fa5-8571-097c81c3130d",publisher_id:"55f5c8e0-762b-4fa5-8571-197c8183130a",first_name:"John",last_name:"Doe",email:"john.doe@mail.com",password:"qwerty123"}]},{}],6:[function(e,t,r){!function(e,r){"function"==typeof define&&define.amd?define([],r):"object"==typeof t&&t.exports?t.exports=r():e.adblockDetect=r()}(this,function(){function e(i,o){o=n(e.defaults,o||{});var s=t(o.testNodeClasses,o.testNodeStyle),a=0,u=!1,c=setInterval(function(){a++,((u=r(s))||a===o.testRuns)&&(clearInterval(c),s.parentNode&&s.parentNode.removeChild(s),i(u))},o.testInterval)}function t(e,t){var r=window.document,n=r.createElement("div");return n.innerHTML="&nbsp;",n.setAttribute("class",e),n.setAttribute("style",t),r.body.appendChild(n),n}function r(e){return 0===e.offsetHeight||!document.body.contains(e)||"none"===e.style.display||"hidden"===e.style.visibility}function n(e,t){var r={};for(var n in e)r[n]=e[n],t.hasOwnProperty(n)&&(r[n]=t[n]);return r}return e.defaults={testNodeClasses:"pub_300x250 pub_300x250m pub_728x90 text-ad textAd text_ad text_ads text-ads text-ad-links",testNodeStyle:"height: 10px !important; font-size: 20px; color: transparent; position: absolute; bottom: 0; left: -10000px;",testInterval:51,testRuns:4},e})},{}],7:[function(e,t,r){function n(e,t){return p.isUndefined(t)?""+t:!p.isNumber(t)||!isNaN(t)&&isFinite(t)?p.isFunction(t)||p.isRegExp(t)?t.toString():t:t.toString()}function i(e,t){return p.isString(e)?e.length<t?e:e.slice(0,t):e}function o(e){return i(JSON.stringify(e.actual,n),128)+" "+e.operator+" "+i(JSON.stringify(e.expected,n),128)}function s(e,t,r,n,i){throw new m.AssertionError({message:r,actual:e,expected:t,operator:n,stackStartFunction:i})}function a(e,t){e||s(e,!0,t,"==",m.ok)}function u(e,t){if(e===t)return!0;if(p.isBuffer(e)&&p.isBuffer(t)){if(e.length!=t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return p.isDate(e)&&p.isDate(t)?e.getTime()===t.getTime():p.isRegExp(e)&&p.isRegExp(t)?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:p.isObject(e)||p.isObject(t)?l(e,t):e==t}function c(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function l(e,t){if(p.isNullOrUndefined(e)||p.isNullOrUndefined(t))return!1;if(e.prototype!==t.prototype)return!1;if(c(e))return!!c(t)&&(e=h.call(e),t=h.call(t),u(e,t));try{var r,n,i=y(e),o=y(t)}catch(e){return!1}if(i.length!=o.length)return!1;for(i.sort(),o.sort(),n=i.length-1;n>=0;n--)if(i[n]!=o[n])return!1;for(n=i.length-1;n>=0;n--)if(r=i[n],!u(e[r],t[r]))return!1;return!0}function f(e,t){return!(!e||!t)&&("[object RegExp]"==Object.prototype.toString.call(t)?t.test(e):e instanceof t||!0===t.call({},e))}function d(e,t,r,n){var i;p.isString(r)&&(n=r,r=null);try{t()}catch(e){i=e}if(n=(r&&r.name?" ("+r.name+").":".")+(n?" "+n:"."),e&&!i&&s(i,r,"Missing expected exception"+n),!e&&f(i,r)&&s(i,r,"Got unwanted exception"+n),e&&i&&r&&!f(i,r)||!e&&i)throw i}var p=e("util/"),h=Array.prototype.slice,v=Object.prototype.hasOwnProperty,m=t.exports=a;m.AssertionError=function(e){this.name="AssertionError",this.actual=e.actual,this.expected=e.expected,this.operator=e.operator,e.message?(this.message=e.message,this.generatedMessage=!1):(this.message=o(this),this.generatedMessage=!0);var t=e.stackStartFunction||s;if(Error.captureStackTrace)Error.captureStackTrace(this,t);else{var r=new Error;if(r.stack){var n=r.stack,i=t.name,a=n.indexOf("\n"+i);if(a>=0){var u=n.indexOf("\n",a+1);n=n.substring(u+1)}this.stack=n}}},p.inherits(m.AssertionError,Error),m.fail=s,m.ok=a,m.equal=function(e,t,r){e!=t&&s(e,t,r,"==",m.equal)},m.notEqual=function(e,t,r){e==t&&s(e,t,r,"!=",m.notEqual)},m.deepEqual=function(e,t,r){u(e,t)||s(e,t,r,"deepEqual",m.deepEqual)},m.notDeepEqual=function(e,t,r){u(e,t)&&s(e,t,r,"notDeepEqual",m.notDeepEqual)},m.strictEqual=function(e,t,r){e!==t&&s(e,t,r,"===",m.strictEqual)},m.notStrictEqual=function(e,t,r){e===t&&s(e,t,r,"!==",m.notStrictEqual)},m.throws=function(e,t,r){d.apply(this,[!0].concat(h.call(arguments)))},m.doesNotThrow=function(e,t){d.apply(this,[!1].concat(h.call(arguments)))},m.ifError=function(e){if(e)throw e};var y=Object.keys||function(e){var t=[];for(var r in e)v.call(e,r)&&t.push(r);return t}},{"util/":21}],8:[function(e,t,r){!function(e,r,n){void 0!==t&&t.exports?t.exports=n():"function"==typeof define&&define.amd?define("bowser",n):e.bowser=n()}(this,0,function(){function e(e){function t(t){var r=e.match(t);return r&&r.length>1&&r[1]||""}var r,n=t(/(ipod|iphone|ipad)/i).toLowerCase(),i=/like android/i.test(e),o=!i&&/android/i.test(e),a=/nexus\s*[0-6]\s*/i.test(e),u=!a&&/nexus\s*[0-9]+/i.test(e),c=/CrOS/.test(e),l=/silk/i.test(e),f=/sailfish/i.test(e),d=/tizen/i.test(e),p=/(web|hpw)os/i.test(e),h=/windows phone/i.test(e),v=(/SamsungBrowser/i.test(e),!h&&/windows/i.test(e)),m=!n&&!l&&/macintosh/i.test(e),y=!o&&!f&&!d&&!p&&/linux/i.test(e),_=t(/edge\/(\d+(\.\d+)?)/i),g=t(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(e),w=!b&&/[^-]mobi/i.test(e),x=/xbox/i.test(e);/opera/i.test(e)?r={name:"Opera",opera:s,version:g||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr|opios/i.test(e)?r={name:"Opera",opera:s,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||g}:/SamsungBrowser/i.test(e)?r={name:"Samsung Internet for Android",samsungBrowser:s,version:g||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?r={name:"Opera Coast",coast:s,version:g||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?r={name:"Yandex Browser",yandexbrowser:s,version:g||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?r={name:"UC Browser",ucbrowser:s,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?r={name:"Maxthon",maxthon:s,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?r={name:"Epiphany",epiphany:s,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?r={name:"Puffin",puffin:s,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?r={name:"Sleipnir",sleipnir:s,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?r={name:"K-Meleon",kMeleon:s,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:h?(r={name:"Windows Phone",windowsphone:s},_?(r.msedge=s,r.version=_):(r.msie=s,r.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?r={name:"Internet Explorer",msie:s,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:c?r={name:"Chrome",chromeos:s,chromeBook:s,chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/chrome.+? edge/i.test(e)?r={name:"Microsoft Edge",msedge:s,version:_}:/vivaldi/i.test(e)?r={name:"Vivaldi",vivaldi:s,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||g}:f?r={name:"Sailfish",sailfish:s,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?r={name:"SeaMonkey",seamonkey:s,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(r={name:"Firefox",firefox:s,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(r.firefoxos=s)):l?r={name:"Amazon Silk",silk:s,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?r={name:"PhantomJS",phantom:s,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?r={name:"SlimerJS",slimer:s,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?r={name:"BlackBerry",blackberry:s,version:g||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:p?(r={name:"WebOS",webos:s,version:g||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(r.touchpad=s)):/bada/i.test(e)?r={name:"Bada",bada:s,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:d?r={name:"Tizen",tizen:s,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/qupzilla/i.test(e)?r={name:"QupZilla",qupzilla:s,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||g}:/chromium/i.test(e)?r={name:"Chromium",chromium:s,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||g}:/chrome|crios|crmo/i.test(e)?r={name:"Chrome",chrome:s,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:o?r={name:"Android",version:g}:/safari|applewebkit/i.test(e)?(r={name:"Safari",safari:s},g&&(r.version=g)):n?(r={name:"iphone"==n?"iPhone":"ipad"==n?"iPad":"iPod"},g&&(r.version=g)):r=/googlebot/i.test(e)?{name:"Googlebot",googlebot:s,version:t(/googlebot\/(\d+(\.\d+))/i)||g}:{name:t(/^(.*)\/(.*) /),version:function(t){var r=e.match(t);return r&&r.length>1&&r[2]||""}(/^(.*)\/(.*) /)},!r.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(r.name=r.name||"Blink",r.blink=s):(r.name=r.name||"Webkit",r.webkit=s),!r.version&&g&&(r.version=g)):!r.opera&&/gecko\//i.test(e)&&(r.name=r.name||"Gecko",r.gecko=s,r.version=r.version||t(/gecko\/(\d+(\.\d+)?)/i)),r.windowsphone||r.msedge||!o&&!r.silk?r.windowsphone||r.msedge||!n?m?r.mac=s:x?r.xbox=s:v?r.windows=s:y&&(r.linux=s):(r[n]=s,r.ios=s):r.android=s;var k="";r.windowsphone?k=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n?(k=t(/os (\d+([_\s]\d+)*) like mac os x/i),k=k.replace(/[_\s]/g,".")):o?k=t(/android[ \/-](\d+(\.\d+)*)/i):r.webos?k=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):r.blackberry?k=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):r.bada?k=t(/bada\/(\d+(\.\d+)*)/i):r.tizen&&(k=t(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(r.osversion=k);var S=k.split(".")[0];return b||u||"ipad"==n||o&&(3==S||S>=4&&!w)||r.silk?r.tablet=s:(w||"iphone"==n||"ipod"==n||o||a||r.blackberry||r.webos||r.bada)&&(r.mobile=s),r.msedge||r.msie&&r.version>=10||r.yandexbrowser&&r.version>=15||r.vivaldi&&r.version>=1||r.chrome&&r.version>=20||r.samsungBrowser&&r.version>=4||r.firefox&&r.version>=20||r.safari&&r.version>=6||r.opera&&r.version>=10||r.ios&&r.osversion&&r.osversion.split(".")[0]>=6||r.blackberry&&r.version>=10.1||r.chromium&&r.version>=20?r.a=s:r.msie&&r.version<10||r.chrome&&r.version<20||r.firefox&&r.version<20||r.safari&&r.version<6||r.opera&&r.version<10||r.ios&&r.osversion&&r.osversion.split(".")[0]<6||r.chromium&&r.version<20?r.c=s:r.x=s,r}function t(e){return e.split(".").length}function r(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function n(e){for(var n=Math.max(t(e[0]),t(e[1])),i=r(e,function(e){var i=n-t(e);return e+=new Array(i+1).join(".0"),r(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--n>=0;){if(i[0][n]>i[1][n])return 1;if(i[0][n]!==i[1][n])return-1;if(0===n)return 0}}function i(t,r,i){var o=a;"string"==typeof r&&(i=r,r=void 0),void 0===r&&(r=!1),i&&(o=e(i));var s=""+o.version;for(var u in t)if(t.hasOwnProperty(u)&&o[u]){if("string"!=typeof t[u])throw new Error("Browser version in the minVersion map should be a string: "+u+": "+String(t));return n([s,t[u]])<0}return r}function o(e,t,r){return!i(e,t,r)}var s=!0,a=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return a.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in a)return!0}return!1},a.isUnsupportedBrowser=i,a.compareVersions=n,a.check=o,a._detect=e,a})},{}],9:[function(e,t,r){!function(e){function n(e,t){t=t||{},this._id=n._generateUUID(),this._promise=t.promise||Promise,this._frameId=t.frameId||"CrossStorageClient-"+this._id,this._origin=n._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=t.timeout||5e3,this._listener=null,this._installListener();var r;t.frameId&&(r=document.getElementById(t.frameId)),r&&this._poll(),r=r||this._createFrame(e),this._hub=r.contentWindow}n.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},n._getOrigin=function(e){var t,r,n;return t=document.createElement("a"),t.href=e,t.host||(t=window.location),r=t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol,n=r+"//"+t.host,n=n.replace(/:80$|:443$/,"")},n._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},n.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise(function(t,r){var n=setTimeout(function(){r(new Error("CrossStorageClient could not connect"))},e._timeout);e._requests.connect.push(function(e){if(clearTimeout(n),e)return r(e);t()})}))},n.prototype.set=function(e,t){return this._request("set",{key:e,value:t})},n.prototype.get=function(e){var t=Array.prototype.slice.call(arguments);return this._request("get",{keys:t})},n.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},n.prototype.clear=function(){return this._request("clear")},n.prototype.getKeys=function(){return this._request("getKeys")},n.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},n.prototype._installListener=function(){var e=this;this._listener=function(t){var r,n,i;if(!e._closed&&t.data&&"string"==typeof t.data&&("null"===t.origin?"file://":t.origin)===e._origin)if("cross-storage:unavailable"!==t.data){if(-1!==t.data.indexOf("cross-storage:")&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n);delete e._requests.connect}if("cross-storage:ready"!==t.data){try{i=JSON.parse(t.data)}catch(e){return}i.id&&e._requests[i.id]&&e._requests[i.id](i.error,i.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(n=new Error("Closing client. Could not access localStorage in hub."),r=0;r<e._requests.connect.length;r++)e._requests.connect[r](n)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},n.prototype._poll=function(){var e,t,r;e=this,r="file://"===e._origin?"*":e._origin,t=setInterval(function(){if(e._connected)return clearInterval(t);e._hub&&e._hub.postMessage("cross-storage:poll",r)},1e3)},n.prototype._createFrame=function(e){var t,r;t=window.document.createElement("iframe"),t.id=this._frameId;for(r in n.frameStyle)n.frameStyle.hasOwnProperty(r)&&(t.style[r]=n.frameStyle[r]);return window.document.body.appendChild(t),t.src=e,t},n.prototype._request=function(e,t){var r,n;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(n=this,n._count++,r={id:this._id+":"+n._count,method:"cross-storage:"+e,params:t},new this._promise(function(e,t){var i,o,s;i=setTimeout(function(){n._requests[r.id]&&(delete n._requests[r.id],t(new Error("Timeout: could not perform "+r.method)))},n._timeout),n._requests[r.id]=function(o,s){if(clearTimeout(i),delete n._requests[r.id],o)return t(new Error(o));e(s)},Array.prototype.toJSON&&(o=Array.prototype.toJSON,Array.prototype.toJSON=null),s="file://"===n._origin?"*":n._origin,n._hub.postMessage(JSON.stringify(r),s),o&&(Array.prototype.toJSON=o)}))},void 0!==t&&t.exports?t.exports=n:void 0!==r?r.CrossStorageClient=n:"function"==typeof define&&define.amd?define([],function(){return n}):e.CrossStorageClient=n}(this)},{}],10:[function(e,t,r){!function(e){var n={};n.init=function(e){var t=!0;try{window.localStorage||(t=!1)}catch(e){t=!1}if(!t)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(e){return}n._permissions=e||[],n._installListener(),window.parent.postMessage("cross-storage:ready","*")},n._installListener=function(){var e=n._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},n._listener=function(e){var t,r,i,o,s,a,u;if(t="null"===e.origin?"file://":e.origin,"cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data){try{i=JSON.parse(e.data)}catch(e){return}if(i&&"string"==typeof i.method&&(o=i.method.split("cross-storage:")[1])){if(n._permitted(t,o))try{a=n["_"+o](i.params)}catch(e){s=e.message}else s="Invalid permissions for "+o;u=JSON.stringify({id:i.id,error:s,result:a}),r="file://"===t?"*":t,window.parent.postMessage(u,r)}}},n._permitted=function(e,t){var r,i,o;if(r=["get","set","del","clear","getKeys"],!n._inArray(t,r))return!1;for(i=0;i<n._permissions.length;i++)if(o=n._permissions[i],o.origin instanceof RegExp&&o.allow instanceof Array&&o.origin.test(e)&&n._inArray(t,o.allow))return!0;return!1},n._set=function(e){window.localStorage.setItem(e.key,e.value)},n._get=function(e){var t,r,n,i;for(t=window.localStorage,r=[],n=0;n<e.keys.length;n++){try{i=t.getItem(e.keys[n])}catch(e){i=null}r.push(i)}return r.length>1?r:r[0]},n._del=function(e){for(var t=0;t<e.keys.length;t++)window.localStorage.removeItem(e.keys[t])},n._clear=function(){window.localStorage.clear()},n._getKeys=function(e){var t,r,n;for(n=[],r=window.localStorage.length,t=0;t<r;t++)n.push(window.localStorage.key(t));return n},n._inArray=function(e,t){for(var r=0;r<t.length;r++)if(e===t[r])return!0;return!1},n._now=function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()},void 0!==t&&t.exports?t.exports=n:void 0!==r?r.CrossStorageHub=n:"function"==typeof define&&define.amd?define([],function(){return n}):e.CrossStorageHub=n}(this)},{}],11:[function(e,t,r){t.exports={CrossStorageClient:e("./client.js"),CrossStorageHub:e("./hub.js")}},{"./client.js":9,"./hub.js":10}],12:[function(e,t,r){(function(n,i){!function(e,n){"object"==typeof r&&void 0!==t?t.exports=n():"function"==typeof define&&define.amd?define(n):e.ES6Promise=n()}(this,function(){"use strict";function t(e){return"function"==typeof e||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function o(e){W=e}function s(e){V=e}function a(){return void 0!==J?function(){J(c)}:u()}function u(){var e=setTimeout;return function(){return e(c,1)}}function c(){for(var e=0;e<H;e+=2){(0,Z[e])(Z[e+1]),Z[e]=void 0,Z[e+1]=void 0}H=0}function l(e,t){var r=arguments,n=this,i=new this.constructor(d);void 0===i[ee]&&C(i);var o=n._state;return o?function(){var e=r[o-1];V(function(){return A(o,i,e,n._result)})}():S(n,i,e,t),i}function f(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(d);return b(r,e),r}function d(){}function p(){return new TypeError("You cannot resolve a promise with itself")}function h(){return new TypeError("A promises callback cannot return that same promise.")}function v(e){try{return e.then}catch(e){return ie.error=e,ie}}function m(e,t,r,n){try{e.call(t,r,n)}catch(e){return e}}function y(e,t,r){V(function(e){var n=!1,i=m(r,t,function(r){n||(n=!0,t!==r?b(e,r):x(e,r))},function(t){n||(n=!0,k(e,t))},"Settle: "+(e._label||" unknown promise"));!n&&i&&(n=!0,k(e,i))},e)}function _(e,t){t._state===re?x(e,t._result):t._state===ne?k(e,t._result):S(t,void 0,function(t){return b(e,t)},function(t){return k(e,t)})}function g(e,t,n){t.constructor===e.constructor&&n===l&&t.constructor.resolve===f?_(e,t):n===ie?k(e,ie.error):void 0===n?x(e,t):r(n)?y(e,t,n):x(e,t)}function b(e,r){e===r?k(e,p()):t(r)?g(e,r,v(r)):x(e,r)}function w(e){e._onerror&&e._onerror(e._result),O(e)}function x(e,t){e._state===te&&(e._result=t,e._state=re,0!==e._subscribers.length&&V(O,e))}function k(e,t){e._state===te&&(e._state=ne,e._result=t,V(w,e))}function S(e,t,r,n){var i=e._subscribers,o=i.length;e._onerror=null,i[o]=t,i[o+re]=r,i[o+ne]=n,0===o&&e._state&&V(O,e)}function O(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var n=void 0,i=void 0,o=e._result,s=0;s<t.length;s+=3)n=t[s],i=t[s+r],n?A(r,n,i,o):i(o);e._subscribers.length=0}}function E(){this.error=null}function j(e,t){try{return e(t)}catch(e){return oe.error=e,oe}}function A(e,t,n,i){var o=r(n),s=void 0,a=void 0,u=void 0,c=void 0;if(o){if(s=j(n,i),s===oe?(c=!0,a=s.error,s=null):u=!0,t===s)return void k(t,h())}else s=i,u=!0;t._state!==te||(o&&u?b(t,s):c?k(t,a):e===re?x(t,s):e===ne&&k(t,s))}function T(e,t){try{t(function(t){b(e,t)},function(t){k(e,t)})}catch(t){k(e,t)}}function P(){return se++}function C(e){e[ee]=se++,e._state=void 0,e._result=void 0,e._subscribers=[]}function U(e,t){this._instanceConstructor=e,this.promise=new e(d),this.promise[ee]||C(this.promise),M(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?x(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&x(this.promise,this._result))):k(this.promise,I())}function I(){return new Error("Array Methods must be provided an Array")}function N(e){return new U(this,e).promise}function D(e){var t=this;return new t(M(e)?function(r,n){for(var i=e.length,o=0;o<i;o++)t.resolve(e[o]).then(r,n)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function q(e){var t=this,r=new t(d);return k(r,e),r}function R(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function B(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function L(e){this[ee]=P(),this._result=this._state=void 0,this._subscribers=[],d!==e&&("function"!=typeof e&&R(),this instanceof L?T(this,e):B())}function F(){var e=void 0;if(void 0!==i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=L}var z=void 0;z=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var M=z,H=0,J=void 0,W=void 0,V=function(e,t){Z[H]=e,Z[H+1]=t,2===(H+=2)&&(W?W(c):Q())},G="undefined"!=typeof window?window:void 0,K=G||{},$=K.MutationObserver||K.WebKitMutationObserver,Y="undefined"==typeof self&&void 0!==n&&"[object process]"==={}.toString.call(n),X="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Z=new Array(1e3),Q=void 0;Q=Y?function(){return function(){return n.nextTick(c)}}():$?function(){var e=0,t=new $(c),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}():X?function(){var e=new MessageChannel;return e.port1.onmessage=c,function(){return e.port2.postMessage(0)}}():void 0===G&&"function"==typeof e?function(){try{var t=e,r=t("vertx");return J=r.runOnLoop||r.runOnContext,a()}catch(e){return u()}}():u();var ee=Math.random().toString(36).substring(16),te=void 0,re=1,ne=2,ie=new E,oe=new E,se=0;return U.prototype._enumerate=function(){for(var e=this.length,t=this._input,r=0;this._state===te&&r<e;r++)this._eachEntry(t[r],r)},U.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,n=r.resolve;if(n===f){var i=v(e);if(i===l&&e._state!==te)this._settledAt(e._state,t,e._result);else if("function"!=typeof i)this._remaining--,this._result[t]=e;else if(r===L){var o=new r(d);g(o,e,i),this._willSettleAt(o,t)}else this._willSettleAt(new r(function(t){return t(e)}),t)}else this._willSettleAt(n(e),t)},U.prototype._settledAt=function(e,t,r){var n=this.promise;n._state===te&&(this._remaining--,e===ne?k(n,r):this._result[t]=r),0===this._remaining&&x(n,this._result)},U.prototype._willSettleAt=function(e,t){var r=this;S(e,void 0,function(e){return r._settledAt(re,t,e)},function(e){return r._settledAt(ne,t,e)})},L.all=N,L.race=D,L.resolve=f,L.reject=q,L._setScheduler=o,L._setAsap=s,L._asap=V,L.prototype={constructor:L,then:l,catch:function(e){return this.then(null,e)}},L.polyfill=F,L.Promise=L,L})}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:13}],13:[function(e,t,r){function n(){}var i=t.exports={};i.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.MutationObserver,r="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};var n=[];if(t){var i=document.createElement("div");return new MutationObserver(function(){var e=n.slice();n.length=0,e.forEach(function(e){e()})}).observe(i,{attributes:!0}),function(e){n.length||i.setAttribute("yes","no"),n.push(e)}}return r?(window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){n.shift()()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}):function(e){setTimeout(e,0)}}(),i.title="browser",i.browser=!0,i.env={},i.argv=[],i.on=n,i.addListener=n,i.once=n,i.off=n,i.removeListener=n,i.removeAllListeners=n,i.emit=n,i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")}},{}],14:[function(e,t,r){"use strict";var n=String.prototype.replace;t.exports={default:"RFC3986",formatters:{RFC1738:function(e){return n.call(e,/%20/g,"+")},RFC3986:function(e){return e}},RFC1738:"RFC1738",RFC3986:"RFC3986"}},{}],15:[function(e,t,r){"use strict";var n=e("./stringify"),i=e("./parse"),o=e("./formats");t.exports={formats:o,parse:i,stringify:n}},{"./formats":14,"./parse":16,"./stringify":17}],16:[function(e,t,r){"use strict";var n=e("./utils"),i=Object.prototype.hasOwnProperty,o={allowDots:!1,allowPrototypes:!1,arrayLimit:20,decoder:n.decode,delimiter:"&",depth:5,parameterLimit:1e3,plainObjects:!1,strictNullHandling:!1},s=function(e,t){for(var r={},n=e.split(t.delimiter,t.parameterLimit===1/0?void 0:t.parameterLimit),o=0;o<n.length;++o){var s,a,u=n[o],c=-1===u.indexOf("]=")?u.indexOf("="):u.indexOf("]=")+1;-1===c?(s=t.decoder(u),a=t.strictNullHandling?null:""):(s=t.decoder(u.slice(0,c)),a=t.decoder(u.slice(c+1))),i.call(r,s)?r[s]=[].concat(r[s]).concat(a):r[s]=a}return r},a=function(e,t,r){if(!e.length)return t;var n,i=e.shift();if("[]"===i)n=[],n=n.concat(a(e,t,r));else{n=r.plainObjects?Object.create(null):{};var o="["===i.charAt(0)&&"]"===i.charAt(i.length-1)?i.slice(1,-1):i,s=parseInt(o,10);!isNaN(s)&&i!==o&&String(s)===o&&s>=0&&r.parseArrays&&s<=r.arrayLimit?(n=[],n[s]=a(e,t,r)):n[o]=a(e,t,r)}return n},u=function(e,t,r){if(e){var n=r.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,s=/(\[[^[\]]*])/g,u=o.exec(n),c=u?n.slice(0,u.index):n,l=[];if(c){if(!r.plainObjects&&i.call(Object.prototype,c)&&!r.allowPrototypes)return;l.push(c)}for(var f=0;null!==(u=s.exec(n))&&f<r.depth;){if(f+=1,!r.plainObjects&&i.call(Object.prototype,u[1].slice(1,-1))&&!r.allowPrototypes)return;l.push(u[1])}return u&&l.push("["+n.slice(u.index)+"]"),a(l,t,r)}};t.exports=function(e,t){var r=t||{};if(null!==r.decoder&&void 0!==r.decoder&&"function"!=typeof r.decoder)throw new TypeError("Decoder has to be a function.");if(r.delimiter="string"==typeof r.delimiter||n.isRegExp(r.delimiter)?r.delimiter:o.delimiter,r.depth="number"==typeof r.depth?r.depth:o.depth,r.arrayLimit="number"==typeof r.arrayLimit?r.arrayLimit:o.arrayLimit,r.parseArrays=!1!==r.parseArrays,r.decoder="function"==typeof r.decoder?r.decoder:o.decoder,r.allowDots="boolean"==typeof r.allowDots?r.allowDots:o.allowDots,r.plainObjects="boolean"==typeof r.plainObjects?r.plainObjects:o.plainObjects,r.allowPrototypes="boolean"==typeof r.allowPrototypes?r.allowPrototypes:o.allowPrototypes,r.parameterLimit="number"==typeof r.parameterLimit?r.parameterLimit:o.parameterLimit,r.strictNullHandling="boolean"==typeof r.strictNullHandling?r.strictNullHandling:o.strictNullHandling,""===e||null===e||void 0===e)return r.plainObjects?Object.create(null):{};for(var i="string"==typeof e?s(e,r):e,a=r.plainObjects?Object.create(null):{},c=Object.keys(i),l=0;l<c.length;++l){var f=c[l],d=u(f,i[f],r);a=n.merge(a,d,r)}return n.compact(a)}},{"./utils":18}],17:[function(e,t,r){"use strict";var n=e("./utils"),i=e("./formats"),o={brackets:function(e){return e+"[]"},indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},s=Date.prototype.toISOString,a={delimiter:"&",encode:!0,encoder:n.encode,encodeValuesOnly:!1,serializeDate:function(e){return s.call(e)},skipNulls:!1,strictNullHandling:!1},u=function e(t,r,i,o,s,a,u,c,l,f,d,p){var h=t;if("function"==typeof u)h=u(r,h);else if(h instanceof Date)h=f(h);else if(null===h){if(o)return a&&!p?a(r):r;h=""}if("string"==typeof h||"number"==typeof h||"boolean"==typeof h||n.isBuffer(h)){if(a){return[d(p?r:a(r))+"="+d(a(h))]}return[d(r)+"="+d(String(h))]}var v=[];if(void 0===h)return v;var m;if(Array.isArray(u))m=u;else{var y=Object.keys(h);m=c?y.sort(c):y}for(var _=0;_<m.length;++_){var g=m[_];s&&null===h[g]||(v=Array.isArray(h)?v.concat(e(h[g],i(r,g),i,o,s,a,u,c,l,f,d,p)):v.concat(e(h[g],r+(l?"."+g:"["+g+"]"),i,o,s,a,u,c,l,f,d,p)))}return v};t.exports=function(e,t){var r=e,n=t||{}
;if(null!==n.encoder&&void 0!==n.encoder&&"function"!=typeof n.encoder)throw new TypeError("Encoder has to be a function.");var s=void 0===n.delimiter?a.delimiter:n.delimiter,c="boolean"==typeof n.strictNullHandling?n.strictNullHandling:a.strictNullHandling,l="boolean"==typeof n.skipNulls?n.skipNulls:a.skipNulls,f="boolean"==typeof n.encode?n.encode:a.encode,d="function"==typeof n.encoder?n.encoder:a.encoder,p="function"==typeof n.sort?n.sort:null,h=void 0!==n.allowDots&&n.allowDots,v="function"==typeof n.serializeDate?n.serializeDate:a.serializeDate,m="boolean"==typeof n.encodeValuesOnly?n.encodeValuesOnly:a.encodeValuesOnly;if(void 0===n.format)n.format=i.default;else if(!Object.prototype.hasOwnProperty.call(i.formatters,n.format))throw new TypeError("Unknown format option provided.");var y,_,g=i.formatters[n.format];"function"==typeof n.filter?(_=n.filter,r=_("",r)):Array.isArray(n.filter)&&(_=n.filter,y=_);var b=[];if("object"!=typeof r||null===r)return"";var w;w=n.arrayFormat in o?n.arrayFormat:"indices"in n?n.indices?"indices":"repeat":"indices";var x=o[w];y||(y=Object.keys(r)),p&&y.sort(p);for(var k=0;k<y.length;++k){var S=y[k];l&&null===r[S]||(b=b.concat(u(r[S],S,x,c,l,f?d:null,_,p,h,v,g,m)))}return b.join(s)}},{"./formats":14,"./utils":18}],18:[function(e,t,r){"use strict";var n=Object.prototype.hasOwnProperty,i=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}();r.arrayToObject=function(e,t){for(var r=t&&t.plainObjects?Object.create(null):{},n=0;n<e.length;++n)void 0!==e[n]&&(r[n]=e[n]);return r},r.merge=function(e,t,i){if(!t)return e;if("object"!=typeof t){if(Array.isArray(e))e.push(t);else{if("object"!=typeof e)return[e,t];(i.plainObjects||i.allowPrototypes||!n.call(Object.prototype,t))&&(e[t]=!0)}return e}if("object"!=typeof e)return[e].concat(t);var o=e;return Array.isArray(e)&&!Array.isArray(t)&&(o=r.arrayToObject(e,i)),Array.isArray(e)&&Array.isArray(t)?(t.forEach(function(t,o){n.call(e,o)?e[o]&&"object"==typeof e[o]?e[o]=r.merge(e[o],t,i):e.push(t):e[o]=t}),e):Object.keys(t).reduce(function(e,n){var o=t[n];return Object.prototype.hasOwnProperty.call(e,n)?e[n]=r.merge(e[n],o,i):e[n]=o,e},o)},r.decode=function(e){try{return decodeURIComponent(e.replace(/\+/g," "))}catch(t){return e}},r.encode=function(e){if(0===e.length)return e;for(var t="string"==typeof e?e:String(e),r="",n=0;n<t.length;++n){var o=t.charCodeAt(n);45===o||46===o||95===o||126===o||o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122?r+=t.charAt(n):o<128?r+=i[o]:o<2048?r+=i[192|o>>6]+i[128|63&o]:o<55296||o>=57344?r+=i[224|o>>12]+i[128|o>>6&63]+i[128|63&o]:(n+=1,o=65536+((1023&o)<<10|1023&t.charCodeAt(n)),r+=i[240|o>>18]+i[128|o>>12&63]+i[128|o>>6&63]+i[128|63&o])}return r},r.compact=function(e,t){if("object"!=typeof e||null===e)return e;var n=t||[],i=n.indexOf(e);if(-1!==i)return n[i];if(n.push(e),Array.isArray(e)){for(var o=[],s=0;s<e.length;++s)e[s]&&"object"==typeof e[s]?o.push(r.compact(e[s],n)):void 0!==e[s]&&o.push(e[s]);return o}return Object.keys(e).forEach(function(t){e[t]=r.compact(e[t],n)}),e},r.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},r.isBuffer=function(e){return null!==e&&void 0!==e&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))}},{}],19:[function(e,t,r){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}},{}],20:[function(e,t,r){t.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],21:[function(e,t,r){(function(t,n){function i(e,t){var n={seen:[],stylize:s};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),v(t)?n.showHidden=t:t&&r._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=o),u(n,e,n.depth)}function o(e,t){var r=i.styles[t];return r?"["+i.colors[r][0]+"m"+e+"["+i.colors[r][1]+"m":e}function s(e,t){return e}function a(e){var t={};return e.forEach(function(e,r){t[e]=!0}),t}function u(e,t,n){if(e.customInspect&&t&&E(t.inspect)&&t.inspect!==r.inspect&&(!t.constructor||t.constructor.prototype!==t)){var i=t.inspect(n,e);return g(i)||(i=u(e,i,n)),i}var o=c(e,t);if(o)return o;var s=Object.keys(t),v=a(s);if(e.showHidden&&(s=Object.getOwnPropertyNames(t)),O(t)&&(s.indexOf("message")>=0||s.indexOf("description")>=0))return l(t);if(0===s.length){if(E(t)){var m=t.name?": "+t.name:"";return e.stylize("[Function"+m+"]","special")}if(x(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(S(t))return e.stylize(Date.prototype.toString.call(t),"date");if(O(t))return l(t)}var y="",_=!1,b=["{","}"];if(h(t)&&(_=!0,b=["[","]"]),E(t)){y=" [Function"+(t.name?": "+t.name:"")+"]"}if(x(t)&&(y=" "+RegExp.prototype.toString.call(t)),S(t)&&(y=" "+Date.prototype.toUTCString.call(t)),O(t)&&(y=" "+l(t)),0===s.length&&(!_||0==t.length))return b[0]+y+b[1];if(n<0)return x(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special");e.seen.push(t);var w;return w=_?f(e,t,n,v,s):s.map(function(r){return d(e,t,n,v,r,_)}),e.seen.pop(),p(w,y,b)}function c(e,t){if(w(t))return e.stylize("undefined","undefined");if(g(t)){var r="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(r,"string")}return _(t)?e.stylize(""+t,"number"):v(t)?e.stylize(""+t,"boolean"):m(t)?e.stylize("null","null"):void 0}function l(e){return"["+Error.prototype.toString.call(e)+"]"}function f(e,t,r,n,i){for(var o=[],s=0,a=t.length;s<a;++s)C(t,String(s))?o.push(d(e,t,r,n,String(s),!0)):o.push("");return i.forEach(function(i){i.match(/^\d+$/)||o.push(d(e,t,r,n,i,!0))}),o}function d(e,t,r,n,i,o){var s,a,c;if(c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]},c.get?a=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(a=e.stylize("[Setter]","special")),C(n,i)||(s="["+i+"]"),a||(e.seen.indexOf(c.value)<0?(a=m(r)?u(e,c.value,null):u(e,c.value,r-1),a.indexOf("\n")>-1&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n"))):a=e.stylize("[Circular]","special")),w(s)){if(o&&i.match(/^\d+$/))return a;s=JSON.stringify(""+i),s.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function p(e,t,r){var n=0;return e.reduce(function(e,t){return n++,t.indexOf("\n")>=0&&n++,e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)>60?r[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+r[1]:r[0]+t+" "+e.join(", ")+" "+r[1]}function h(e){return Array.isArray(e)}function v(e){return"boolean"==typeof e}function m(e){return null===e}function y(e){return null==e}function _(e){return"number"==typeof e}function g(e){return"string"==typeof e}function b(e){return"symbol"==typeof e}function w(e){return void 0===e}function x(e){return k(e)&&"[object RegExp]"===A(e)}function k(e){return"object"==typeof e&&null!==e}function S(e){return k(e)&&"[object Date]"===A(e)}function O(e){return k(e)&&("[object Error]"===A(e)||e instanceof Error)}function E(e){return"function"==typeof e}function j(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e}function A(e){return Object.prototype.toString.call(e)}function T(e){return e<10?"0"+e.toString(10):e.toString(10)}function P(){var e=new Date,t=[T(e.getHours()),T(e.getMinutes()),T(e.getSeconds())].join(":");return[e.getDate(),N[e.getMonth()],t].join(" ")}function C(e,t){return Object.prototype.hasOwnProperty.call(e,t)}r.format=function(e){if(!g(e)){for(var t=[],r=0;r<arguments.length;r++)t.push(i(arguments[r]));return t.join(" ")}for(var r=1,n=arguments,o=n.length,s=String(e).replace(/%[sdj%]/g,function(e){if("%%"===e)return"%";if(r>=o)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(e){return"[Circular]"}default:return e}}),a=n[r];r<o;a=n[++r])m(a)||!k(a)?s+=" "+a:s+=" "+i(a);return s},r.deprecate=function(e,i){function o(){if(!s){if(t.throwDeprecation)throw new Error(i);t.traceDeprecation?console.trace(i):console.error(i),s=!0}return e.apply(this,arguments)}if(w(n.process))return function(){return r.deprecate(e,i).apply(this,arguments)};if(!0===t.noDeprecation)return e;var s=!1;return o};var U,I={};r.debuglog=function(e){if(w(U)&&(U=t.env.NODE_DEBUG||""),e=e.toUpperCase(),!I[e])if(new RegExp("\\b"+e+"\\b","i").test(U)){var n=t.pid;I[e]=function(){var t=r.format.apply(r,arguments);console.error("%s %d: %s",e,n,t)}}else I[e]=function(){};return I[e]},r.inspect=i,i.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},i.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},r.isArray=h,r.isBoolean=v,r.isNull=m,r.isNullOrUndefined=y,r.isNumber=_,r.isString=g,r.isSymbol=b,r.isUndefined=w,r.isRegExp=x,r.isObject=k,r.isDate=S,r.isError=O,r.isFunction=E,r.isPrimitive=j,r.isBuffer=e("./support/isBuffer");var N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];r.log=function(){console.log("%s - %s",P(),r.format.apply(r,arguments))},r.inherits=e("inherits"),r._extend=function(e,t){if(!t||!k(t))return e;for(var r=Object.keys(t),n=r.length;n--;)e[r[n]]=t[r[n]];return e}}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":20,_process:13,inherits:19}],22:[function(e,t,r){!function(e){"use strict";function t(e){if("string"!=typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(e))throw new TypeError("Invalid character in header field name");return e.toLowerCase()}function r(e){return"string"!=typeof e&&(e=String(e)),e}function n(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return y.iterable&&(t[Symbol.iterator]=function(){return t}),t}function i(e){this.map={},e instanceof i?e.forEach(function(e,t){this.append(t,e)},this):e&&Object.getOwnPropertyNames(e).forEach(function(t){this.append(t,e[t])},this)}function o(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function s(e){return new Promise(function(t,r){e.onload=function(){t(e.result)},e.onerror=function(){r(e.error)}})}function a(e){var t=new FileReader,r=s(t);return t.readAsArrayBuffer(e),r}function u(e){var t=new FileReader,r=s(t);return t.readAsText(e),r}function c(e){for(var t=new Uint8Array(e),r=new Array(t.length),n=0;n<t.length;n++)r[n]=String.fromCharCode(t[n]);return r.join("")}function l(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function f(){return this.bodyUsed=!1,this._initBody=function(e){if(this._bodyInit=e,e)if("string"==typeof e)this._bodyText=e;else if(y.blob&&Blob.prototype.isPrototypeOf(e))this._bodyBlob=e;else if(y.formData&&FormData.prototype.isPrototypeOf(e))this._bodyFormData=e;else if(y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e))this._bodyText=e.toString();else if(y.arrayBuffer&&y.blob&&g(e))this._bodyArrayBuffer=l(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer]);else{if(!y.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(e)&&!b(e))throw new Error("unsupported BodyInit type");this._bodyArrayBuffer=l(e)}else this._bodyText="";this.headers.get("content-type")||("string"==typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):y.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},y.blob&&(this.blob=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this._bodyArrayBuffer?o(this)||Promise.resolve(this._bodyArrayBuffer):this.blob().then(a)}),this.text=function(){var e=o(this);if(e)return e;if(this._bodyBlob)return u(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(c(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},y.formData&&(this.formData=function(){return this.text().then(h)}),this.json=function(){return this.text().then(JSON.parse)},this}function d(e){var t=e.toUpperCase();return w.indexOf(t)>-1?t:e}function p(e,t){t=t||{};var r=t.body;if(e instanceof p){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new i(e.headers)),this.method=e.method,this.mode=e.mode,r||null==e._bodyInit||(r=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"omit",!t.headers&&this.headers||(this.headers=new i(t.headers)),this.method=d(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&r)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(r)}function h(e){var t=new FormData;return e.trim().split("&").forEach(function(e){if(e){var r=e.split("="),n=r.shift().replace(/\+/g," "),i=r.join("=").replace(/\+/g," ");t.append(decodeURIComponent(n),decodeURIComponent(i))}}),t}function v(e){var t=new i;return e.split(/\r?\n/).forEach(function(e){var r=e.split(":"),n=r.shift().trim();if(n){var i=r.join(":").trim();t.append(n,i)}}),t}function m(e,t){t||(t={}),this.type="default",this.status="status"in t?t.status:200,this.ok=this.status>=200&&this.status<300,this.statusText="statusText"in t?t.statusText:"OK",this.headers=new i(t.headers),this.url=t.url||"",this._initBody(e)}if(!e.fetch){var y={searchParams:"URLSearchParams"in e,iterable:"Symbol"in e&&"iterator"in Symbol,blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};if(y.arrayBuffer)var _=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],g=function(e){return e&&DataView.prototype.isPrototypeOf(e)},b=ArrayBuffer.isView||function(e){return e&&_.indexOf(Object.prototype.toString.call(e))>-1};i.prototype.append=function(e,n){e=t(e),n=r(n);var i=this.map[e];this.map[e]=i?i+","+n:n},i.prototype.delete=function(e){delete this.map[t(e)]},i.prototype.get=function(e){return e=t(e),this.has(e)?this.map[e]:null},i.prototype.has=function(e){return this.map.hasOwnProperty(t(e))},i.prototype.set=function(e,n){this.map[t(e)]=r(n)},i.prototype.forEach=function(e,t){for(var r in this.map)this.map.hasOwnProperty(r)&&e.call(t,this.map[r],r,this)},i.prototype.keys=function(){var e=[];return this.forEach(function(t,r){e.push(r)}),n(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),n(e)},i.prototype.entries=function(){var e=[];return this.forEach(function(t,r){e.push([r,t])}),n(e)},y.iterable&&(i.prototype[Symbol.iterator]=i.prototype.entries);var w=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];p.prototype.clone=function(){return new p(this,{body:this._bodyInit})},f.call(p.prototype),f.call(m.prototype),m.prototype.clone=function(){return new m(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new i(this.headers),url:this.url})},m.error=function(){var e=new m(null,{status:0,statusText:""});return e.type="error",e};var x=[301,302,303,307,308];m.redirect=function(e,t){if(-1===x.indexOf(t))throw new RangeError("Invalid status code");return new m(null,{status:t,headers:{location:e}})},e.Headers=i,e.Request=p,e.Response=m,e.fetch=function(e,t){return new Promise(function(r,n){var i=new p(e,t),o=new XMLHttpRequest;o.onload=function(){var e={status:o.status,statusText:o.statusText,headers:v(o.getAllResponseHeaders()||"")};e.url="responseURL"in o?o.responseURL:e.headers.get("X-Request-URL");var t="response"in o?o.response:o.responseText;r(new m(t,e))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(i.method,i.url,!0),"include"===i.credentials&&(o.withCredentials=!0),"responseType"in o&&y.blob&&(o.responseType="blob"),i.headers.forEach(function(e,t){o.setRequestHeader(t,e)}),o.send(void 0===i._bodyInit?null:i._bodyInit)})},e.fetch.polyfill=!0}}("undefined"!=typeof self?self:this)},{}],23:[function(e,t,r){"use strict";t.exports.Production=e("./production"),t.exports.Sandbox=e("./sandbox")},{"./production":24,"./sandbox":25}],24:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=function(){function e(t){var r=void 0===arguments[1]?function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return window.fetch.apply(window,t)}:arguments[1];i(this,e),this._endpoint=t,this._fetchFn=r}return n(e,{invoke:{value:function(e,t){var r=0;return this._fetchFn(this._endpoint+"/"+e,t).then(function(e){return r=e.status,204!==r?e.json():Promise.resolve({})}).then(function(e){return{body:e,status:r}})}}}),e}();t.exports=o},{}],25:[function(e,t,r){"use strict";var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){for(var r,n=[],i=e[Symbol.iterator]();!(r=i.next()).done&&(n.push(r.value),!t||n.length!==t););return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("../utils"),a=e("qs"),u=s.stripBearer,c=function(){var e=void 0===arguments[0]?200:arguments[0],t=void 0===arguments[1]?{}:arguments[1];return Promise.resolve({status:e,body:t})},l=function(){function e(t){o(this,e),this._database=t}return i(e,{invoke:{value:function(t,r){var i=t.split("/"),o=n(i,2),s=o[0],a=o[1],u=r.method,c=r.body,l=r.headers;return e.resources[s][u](this._database,a,c,l)}}},{resources:{get:function(){return{users:{GET:function(e,t,r,n){var i=u(n.Authorization);return e.hasUserWithToken(i)?c(200,e.getUserWithToken(i)):c(404,{error:"not_found"})},POST:function(e,t,r){var n=JSON.parse(r),i=n.email,o=n.password,s=n.first_name,a=n.last_name;if(e.hasUserWithData(i,o))return c(400,{error:"validation_failed"});var u=e.addUser(i,o,s,a);return c(201,u)},PATCH:function(e,t,r,n){var i=u(n.Authorization),o=JSON.parse(r),s=o.first_name,a=o.last_name;if(e.getUserWithToken(i)!==e.getUserWithId(t))return c(400,{error:"invalid_grant"});var l=e.updateUser(t,s,a);return c(200,l)}},token:{POST:function(e,t,r){var n=a.parse(r),i=n.grant_type,o=n.username,s=n.password,u=n.refresh_token;if("password"===i){if(!e.hasUserWithData(o,s))return c(404,{error:"not_found"});var l=e.getUserWithData(o,s);return c(200,e.getTokenFor(l.id))}if("refresh_token"===i){if(!e.hasTokenWithRefresh(u))return c(400,{error:"invalid_token"});var f=e.updateToken(u);return c(200,f)}return c(404,{error:"unexpected_error"})}},passwords:{POST:function(e,t,r){var n=JSON.parse(r),i=n.email;return e.hasUserWithEmail(i)?c():c(404,{error:"not_found"})},PUT:function(e,t){return e.hasPasswordResetToken(t)?c():c(404,{error:"not_found"})}}}}}}),e}();t.exports=l},{"../utils":36,qs:15}],26:[function(e,t,r){"use strict";var n=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},i=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("../utils"),a=s.generateRandomString,u=s.generateRandomUUID,c=function(){function e(t,r,i){o(this,e),this._users=[].concat(n(t)),this._tokens=[].concat(n(r)),this._passwords=[].concat(n(i))}return i(e,{users:{get:function(){return this._users}},tokens:{get:function(){return this._tokens}},_extractUser:{value:function(e){return{id:e.id,publisher_id:e.publisher_id,first_name:e.first_name,last_name:e.last_name,email:e.email}}},_extractToken:{value:function(e){return{access_token:e.access_token,refresh_token:e.refresh_token}}},hasTokenWithRefresh:{value:function(e){return!!~this._tokens.findIndex(function(t){return t.refresh_token===e})}},hasUserWithData:{value:function(e,t){return!!~this._users.findIndex(function(r){return r.email===e&&r.password===t})}},hasUserWithToken:{value:function(e){return!!~this._tokens.findIndex(function(t){return t.access_token===e})}},getTokenFor:{value:function(e){return this._tokens.find(function(t){return t.user_id===e})}},hasUserWithEmail:{value:function(e){return!!~this._users.findIndex(function(t){return t.email===e})}},hasPasswordResetToken:{value:function(e){return!!~this._passwords.findIndex(function(t){return t.token===e})}},getUserWithData:{value:function(e,t){return this._extractUser(this._users.find(function(r){return r.email===e&&r.password===t}))}},getUserWithId:{value:function(e){return this._extractUser(this._users.find(function(t){return t.id===e}))}},getUserWithToken:{value:function(e){var t=this._tokens.find(function(t){return t.access_token===e}).user_id;return this.getUserWithId(t)}},addUser:{value:function(e,t,r,n){var i=u(),o=u(),s=a(),c=a(),l={user_id:i,access_token:s,refresh_token:c},f={id:i,publisher_id:o,email:e,password:t,first_name:r,last_name:n};return this._tokens.push(l),this._users.push(f),this._extractUser(f)}},updateUser:{value:function(e,t,r){var n=this._users.find(function(t){return t.id===e});return void 0!==t&&(n.first_name=t),void 0!==r&&(n.last_name=r),this._extractUser(n)}},updateToken:{value:function(e){var t=this._tokens.find(function(t){return t.refresh_token===e});return t.access_token=a(),t.refresh_token=a(),this._extractToken(t)}}}),e}();t.exports=c},{"../utils":36}],27:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("../services/consumer"),a=e("../utils").validatePassword,u=function(){function e(t){i(this,e),o(t instanceof s,"`consumer` should be instance of Consumer"),this._consumer=t}return n(e,{requestPasswordReset:{value:function(e){return o(e,"Missing `email`"),this._consumer.requestPasswordReset(e).then(function(){return Promise.resolve({message:"A reset link has been sent to your email"})})}},resetPassword:{value:function(e,t){o(e,"Missing `token`"),o(t,"Missing `password`");var r=a(t),n=r.isValid,i=r.message;return n?this._consumer.resetPassword(e,t).then(function(){return Promise.resolve({message:"Your password has been reset"})}):Promise.reject(new Error(i))}}}),e}();t.exports=u},{"../services/consumer":32,"../utils":36,assert:7}],28:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=function(){function e(t,r){i(this,e),o(t,"Missing `id`"),o(r,"Missing `secret`"),this._id=t,this._secret=r}return n(e,{id:{get:function(){return this._id}},secret:{get:function(){return this._secret}}}),e}();t.exports=s},{assert:7}],29:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("../models/user"),a=e("../utils").retrieveURL,u=e("../utils").redirectToURL,c=function(){function e(t,r){var n=void 0===arguments[2]?u:arguments[2],c=void 0===arguments[3]?a:arguments[3];i(this,e),o(t instanceof s,"`user` should be instance of User"),o(r,"`loginHost` is not defined"),this._user=t,this._loginHost=r,this._redirectFn=n,this._pageURL=c}return n(e,{isValid:{get:function(){return void 0!==this._user.bearer}},initialize:{value:function(){return this._user.syncWithStore()}},invalidate:{value:function(){return this._redirectFn(this._loginHost+"/logout")}},validate:{value:function(){var e=encodeURIComponent(this._pageURL());return this._redirectFn(this._loginHost+"/login?redirectUrl="+e)}}}),e}();t.exports=c},{"../models/user":30,"../utils":36,assert:7}],30:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("../services/consumer"),a=e("../services/store"),u=e("../utils").validatePassword,c=function(){function e(t,r){i(this,e),o(t instanceof a,"`store` should be instance of Store"),o(r instanceof s,"`consumer` should be instance of Consumer"),this._store=t,this._consumer=r,this._bearer=void 0,this._id=void 0,this._publisherId=void 0,this._firstName=void 0,this._lastName=void 0,this._email=void 0,this._isDirty=!1}return n(e,{id:{get:function(){return this._id}},publisherId:{get:function(){return this._publisherId}},email:{get:function(){return this._email}},bearer:{get:function(){return this._bearer}},firstName:{get:function(){return this._firstName},set:function(e){e&&(this._isDirty=!0,this._firstName=e)}},lastName:{get:function(){return this._lastName},set:function(e){e&&(this._isDirty=!0,this._lastName=e)}},syncWithStore:{value:function(){var e=this,t=void 0;return this._store.retriveToken().then(function(r){return t=r,e._consumer.retrieveUser(r)}).then(function(r){return e._id=r.id,e._publisherId=r.publisher_id,e._email=r.email,e._firstName=r.first_name,e._lastName=r.last_name,e._bearer=t,e._isDirty=!1,Promise.resolve({data:r,message:"Synced User model with Store"})})}},save:{value:function(){var e=this;return this._id?this._isDirty?this._consumer.updateUser(this._id,this._bearer,{firstName:this._firstName,lastName:this._lastName}).then(function(){return e._isDirty=!1,Promise.resolve({message:"Updated User model"})}):Promise.resolve({message:"No User model changes to sync"}):Promise.reject(new Error("Cannot save a non-existent User"))}},create:{value:function(e,t,r,n){var i=this;o(e,"Missing `email`"),o(t,"Missing `password`");var s=u(t),a=s.isValid,c=s.message;return a?this._consumer.createUser(e,t,r,n).then(function(e){return i._id=e.id,i._publisherId=e.publisher_id,i._firstName=e.first_name,i._lastName=e.last_name,i._email=e.email,i._isDirty=!1,Promise.resolve({data:e,message:"Created User"})}):Promise.reject(new Error(c))}},authenticate:{value:function(e,t){var r=this;o(e,"Missing `username`"),o(t,"Missing `password`");var n=void 0;return this._consumer.retrieveToken(e,t).then(function(e){var t=e.access_token,i=e.refresh_token;return n=t,r._store.set("access_token",t).then(function(){return r._store.set("refresh_token",i)}).then(function(){return r._consumer.retrieveUser(t)})}).then(function(e){return r._bearer=n,r._id=e.id,r._publisherId=e.publisher_id,r._email=e.email,r._firstName=e.first_name,r._lastName=e.last_name,r._isDirty=!1,Promise.resolve({data:e,message:"Authenticated User"})})}},authenticateWithToken:{value:function(e,t){var r=this;return o(e,"Missing `accessToken`"),this._store.set("access_token",e),t?this._store.set("refresh_token",t):this._store.remove("refresh_token"),this._consumer.retrieveUser(e).catch(function(e){return t&&"invalid_token"===e.name?r._consumer.refreshToken(t).then(function(e){return r._store.set("access_token",e.access_token),r._store.set("refresh_token",e.refresh_token),r._consumer.retrieveUser(e.access_token)}):Promise.reject(e)}).then(function(t){return r._bearer=e,r._id=t.id,r._publisherId=t.publisher_id,r._email=t.email,r._firstName=t.first_name,r._lastName=t.last_name,r._isDirty=!1,Promise.resolve({data:t,message:"Authenticated User"})})}},flush:{value:function(){return this._bearer=void 0,this._id=void 0,this._publisherId=void 0,this._firstName=void 0,this._lastName=void 0,this._email=void 0,this._isDirty=!1,this._store.remove("access_token","refresh_token").then(function(){return Promise.resolve({message:"Flushed User data"})})}}}),e}();t.exports=c},{"../services/consumer":32,"../services/store":35,"../utils":36,assert:7}],31:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("adblock-detect"),s=function(){function e(){var t=void 0===arguments[0]?o:arguments[0];i(this,e),this._detector=t}return n(e,{detect:{value:function(e){return this._detector(e)}}}),e}();t.exports=s},{"adblock-detect":6}],32:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("qs"),a=e("../models/client"),u=e("../api").Production,c=e("../api").Sandbox,l=e("../utils").extractErrorMessage,f=function(){function e(t,r){i(this,e),o(t instanceof a,"`client` should be instance of Client"),o(r instanceof u||r instanceof c,"`api` should be instance of API.Production or API.Sandbox"),this._client=t,this._api=r}return n(e,{_request:{value:function(e,t){return this._api.invoke(e,t).then(function(e){var t=e.status,r=e.body;if(parseInt(t,10)>=400){var n=new Error(l(r));return Promise.reject(n)}return Promise.resolve(r)})}},retrieveToken:{value:function(e,t){return this._request("token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this._formEncode({username:e,password:t,grant_type:"password",client_id:this._client.id,client_secret:this._client.secret})})}},refreshToken:{value:function(e){var t=function(t){return e.apply(this,arguments)};return t.toString=function(){return e.toString()},t}(function(e){return this._request("token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:this._formEncode({refresh_token:e,grant_type:"refresh_token",client_id:this._client.id,client_secret:this._client.secret})})})},_formEncode:{value:function(e){return s.stringify(e)}},_jsonEncode:{value:function(e){
return JSON.stringify(e)}},createUser:{value:function(e,t,r,n){return this._request("users",{method:"POST",headers:{"Content-Type":"application/json"},body:this._jsonEncode({email:e,password:t,first_name:r,last_name:n})})}},retrieveUser:{value:function(e){return this._request("users/me",{headers:{Authorization:"Bearer "+e,"Content-Type":"application/json"},method:"GET"})}},updateUser:{value:function(e,t,r){return this._request("users/"+e,{method:"PATCH",headers:{Authorization:"Bearer "+t,"Content-Type":"application/json"},body:this._jsonEncode({first_name:r.firstName,last_name:r.lastName})})}},requestPasswordReset:{value:function(e){return this._request("passwords",{method:"POST",headers:{"Content-Type":"application/json"},body:this._jsonEncode({email:e})})}},resetPassword:{value:function(e,t){return this._request("passwords/"+e,{method:"PUT",headers:{"Content-Type":"application/json"},body:this._jsonEncode({password:t})})}}}),e}();t.exports=f},{"../api":23,"../models/client":28,"../utils":36,assert:7,qs:15}],33:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("cross-storage").CrossStorageClient,a=function(){function e(t){var r=void 0===arguments[1]?s:arguments[1];i(this,e),o(t,"Missing `iframeHub`"),this._iframeHub=t,this._CrossStorageClientClass=r,this._instance=void 0}return n(e,{onConnect:{value:function(){return this._instance||(this._instance=new this._CrossStorageClientClass(this._iframeHub)),this._instance.onConnect()}},get:{value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.onConnect().then(function(){var t;return(t=e._instance).get.apply(t,r)})}},set:{value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.onConnect().then(function(){var t;return(t=e._instance).set.apply(t,r)})}},del:{value:function(){for(var e=this,t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return this.onConnect().then(function(){var t;return(t=e._instance).del.apply(t,r)})}}}),e}();t.exports=a},{assert:7,"cross-storage":11}],34:[function(e,t,r){"use strict";var n=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},o=e("assert"),s=e("../models/user"),a=e("./store"),u=e("../utils").redirectToURL,c=e("../utils").extractLoginTokenFromURL,l=e("../utils").retrieveURL,f=function(){function e(t,r){var n=void 0===arguments[2]?u:arguments[2],c=void 0===arguments[3]?l:arguments[3];i(this,e),o(t instanceof a,"`store` should be instance of Store"),o(r instanceof s,"`store` should be instance of Store"),this._store=t,this._user=r,this._redirectFn=n,this._retrieveURLFn=c}return n(e,{authenticatedRedirect:{value:function(e,t){if(this._store.supportsCrossStorage())return this._redirectFn(e);var r=~e.indexOf("?")?"&":"?",n=t||c(this._retrieveURLFn())||this._user.bearer;return this._redirectFn(""+e+r+"loginToken="+n)}}}),e}();t.exports=f},{"../models/user":30,"../utils":36,"./store":35,assert:7}],35:[function(e,t,r){"use strict";var n=function(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)},i=function(){function e(e,t){for(var r in t){var n=t[r];n.configurable=!0,n.value&&(n.writable=!0)}Object.defineProperties(e,t)}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},s=e("assert"),a=e("./hub-storage-client"),u=e("../utils").retrieveBrowserName,c=e("../utils").extractLoginTokenFromURL,l=e("../utils").retrieveURL,f="Safari"!==u(),d=function(){function e(t,r){var n=void 0===arguments[2]?a:arguments[2],i=void 0===arguments[3]?f:arguments[3],u=void 0===arguments[4]?l:arguments[4];o(this,e),s(t,"Missing `domain`"),s(r,"Missing `iframeHub`"),this._domain=t,this._iframeHub=r,this._hubStorage=new n(r),this._isCrossStorageAvailable=i,this._retrieveURLFn=u}return i(e,{_normalizeKey:{value:function(e){return this._domain+"_"+e}},supportsCrossStorage:{value:function(){return this._isCrossStorageAvailable}},retriveToken:{value:function(){return this._isCrossStorageAvailable?this.get("access_token"):Promise.resolve(c(this._retrieveURLFn()))}},set:{value:function(e,t){return this._hubStorage.set(this._normalizeKey(e),t)}},get:{value:function(e){return this._hubStorage.get(this._normalizeKey(e))}},remove:{value:function(){for(var e,t=this,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];var s=i.map(function(e){return t._normalizeKey(e)});return(e=this._hubStorage).del.apply(e,n(s))}}}),e}();t.exports=d},{"../utils":36,"./hub-storage-client":33,assert:7}],36:[function(e,t,r){"use strict";function n(){return Math.random().toString(18).slice(2)}function i(){var e=""+n()+n();return e.substring(0,8)+"-"+e.substring(9,13)+"-"+e.substring(14,18)+"-"+e.substring(19,23)+"-"+e.substring(24,36)}function o(e){return(""+e).replace("Bearer","").trim()}var s=e("bowser");t.exports.generateRandomString=n,t.exports.generateRandomUUID=i,t.exports.stripBearer=o;var a=function(e){switch(e.error){case"validation_failed":return"Validation failed: "+e.error_description;case"not_found":return"Not found";case"forbidden_resource":return"Forbidden resource";case"access_denied":return"The resource owner or authorization server denied the request";case"unsupported_grant_type":return"The authorization grant type is not supported";case"invalid_grant":return"Invalid credentials";case"unauthorized_request":return"Unauthorized request";case"unauthorized_client":return"The authenticated client is not authorized";case"invalid_token":return"The access token provided is expired, revoked, malformed, or invalid";case"invalid_scope":return"The requested scope is invalid, unknown, or malformed";case"invalid_client":return"Client authentication failed";case"invalid_request":return"The request is missing a required parameter";default:return"Unexpected error"}};t.exports.extractErrorMessage=a;var u=function(e){var t=/\s/i.test(e),r=/\d/i.test(e),n=/[a-z]/i.test(e);return t?{message:"Password cannot contain spaces",isValid:!1}:r&&n?e.length<8?{message:"Password must be at least 8 characters long",isValid:!1}:{isValid:!0}:{message:"Password must contain both numbers and characters",isValid:!1}};t.exports.validatePassword=u;var c=function(e){try{return decodeURIComponent(e).split("?")[1].split("&").find(function(e){return String(e).includes("loginToken")}).replace("loginToken=","")}catch(e){return""}};t.exports.extractLoginTokenFromURL=c;var l=function(){return(void 0===arguments[0]?s:arguments[0]).name};t.exports.retrieveBrowserName=l;var f=function(e){window.location.replace(e)};t.exports.redirectToURL=f;var d=function(){return window.location.href};t.exports.retrieveURL=d},{bowser:8}]},{},[1]);